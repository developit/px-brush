!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("px-brush",[],e):"object"==typeof exports?exports["px-brush"]=e():t["px-brush"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=((a=r(1))&&a.__esModule?a:{default:a}).default;e.default=n,t.exports=e.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,n=(a=r(2))&&a.__esModule?a:{default:a};function o(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.context=e.getContext("2d"),this.stampMaker=new n.default,this.configPixelRatio()}var e,r,a;return e=t,(r=[{key:"configPixelRatio",value:function(){var t=this.canvas,e=t.width,r=t.height;this.canvas.width=e*this.dpr,this.canvas.height=r*this.dpr,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(r,"px"),this.context.scale(this.dpr,this.dpr),this.context.imageSmoothingEnabled=!1}},{key:"exportAsPNG",value:function(t){var e=this;return new Promise(function(r){var a=document.createElement("canvas"),n=a.getContext("2d"),o=e.canvas,i=o.width,u=o.height,s=i/e.dpr,c=u/e.dpr;a.width=s,a.height=c,n.imageSmoothingEnabled=!1,n.drawImage(e.canvas,0,0,i,u,0,0,s,c),a.toBlob(function(e){e.lastModifedDate=new Date,e.name=t,r(e)})})}},{key:"distanceBetween",value:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"angleBetween",value:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)}},{key:"draw",value:function(t){var e=t.from,r=t.to,a=t.size,n=t.color;this.context.globalCompositeOperation="source-over",this.brush({from:e,to:r,size:a,color:n})}},{key:"erase",value:function(t){var e=t.from,r=t.to,a=t.size;this.context.globalCompositeOperation="destination-out",this.brush({from:e,to:r,size:a,color:"#000000"})}},{key:"brush",value:function(t){var e=this,r=t.from,a=t.to,n=t.size,o=t.color,i=(n-n%2)/2,u=this.stampMaker.make({size:n,color:o});if(r.x!==a.x||r.y!==a.y)for(var s=this.distanceBetween(r,a),c=this.angleBetween(r,a),l=function(t){var a=r.x+Math.sin(c)*t-i,o=r.y+Math.cos(c)*t-i;window.requestAnimationFrame(function(){e.context.drawImage(u,Math.round(a),Math.round(o),n,n)})},f=0;f<s;f+=1)l(f);else{var d=r.x-i,h=r.y-i;this.context.drawImage(u,Math.round(d),Math.round(h),n,n)}}},{key:"dpr",get:function(){return window.devicePixelRatio||1}}])&&o(e.prototype,r),a&&o(e,a),t}();e.default=i,t.exports=e.default},function(t,e,r){"use strict";function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],a=!0,n=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(a=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{a||null==u.return||u.return()}finally{if(n)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=/^#?[0-9A-Fa-f]{1,2}[0-9A-Fa-f]{1,2}[0-9A-Fa-f]{1,2}$/,u=/^rgb\((\s+)?[0-9]{1,3},(\s+)?[0-9]{1,3},(\s+)?[0-9]{1,3}(\s+)?\)$/,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvases={}}var e,r,s;return e=t,(r=[{key:"parseColor",value:function(t){var e=i.test(t),r=u.test(t);if(!e&&!r)throw new Error("Color is not correct format. #123123 or rgb(123, 123, 123) format required.");if(e){var o="#"===t[0]?t.slice(1):t;return o=3===o.length?o.split("").reduce(function(t,e){return[].concat(n(t),[e,e])},[]).join(""):o,{r:parseInt(o.slice(0,2),16),g:parseInt(o.slice(2,4),16),b:parseInt(o.slice(4,6),16)}}if(r){var s=a(t.replace(/rgb|\s+|\(|\)/g,"").split(",").map(function(t){return parseInt(t)}),3),c=s[0],l=s[1],f=s[2];return{r:c=c>255?255:c,g:l=l>255?255:l,b:f=f>255?255:f}}}},{key:"make",value:function(t){var e=t.size,r=t.color;try{e*=window.devicePixelRatio;var a=this.parseColor(r),n=JSON.stringify(a);if(this.canvases[n]=this.canvases[n]||{},null!=this.canvases[n][e])return this.canvases[n][e];var o=document.createElement("canvas");e+=e%2,o.width=e,o.height=e;for(var i=o.getContext("2d"),u=i.createImageData(e,e),s=0;s<u.data.length;s+=4)u.data[s]=255,u.data[s+1]=255,u.data[s+2]=255,u.data[s+3]=0;return this.plotCircle(2*e,4*e*(e/2),e/2,u,e,a),this.fillCircle(u,a),i.putImageData(u,0,0),this.canvases[n][e]=o,o}catch(t){console.error(t)}}},{key:"plotCircle",value:function(t,e,r,a,n,o){var i=-r,u=0,s=2-2*r;do{var c=t-4*(i+1)+(e+4*n*(u-1));a.data[c+0]=o.r,a.data[c+1]=o.g,a.data[c+2]=o.b,a.data[c+3]=255;var l=t-u*(4*n)+(e-4*(i+1));a.data[l+0]=o.r,a.data[l+1]=o.g,a.data[l+2]=o.b,a.data[l+3]=255;var f=t+4*i+(e-u*(4*n));a.data[f+0]=o.r,a.data[f+1]=o.g,a.data[f+2]=o.b,a.data[f+3]=255;var d=t+4*n*(u-1)+(e+4*i);a.data[d+0]=o.r,a.data[d+1]=o.g,a.data[d+2]=o.b,a.data[d+3]=255,(r=s)<=u&&(s+=2*++u+1),(r>i||s>u)&&(s+=2*++i+1)}while(i<0)}},{key:"fillCircle",value:function(t,e){for(var r=4*t.width,a=1;a<t.height-1;a+=1)for(var n=!1,o=!1,i=!1,u=0;u<r;u+=4){var s=r*a+u,c=t.data[s+3],l=255===c;l&&!n?n=!0:0===c&&n?o=!0:l&&n&&o&&(i=!0),n&&o&&!i&&(t.data[s]=e.r,t.data[s+1]=e.g,t.data[s+2]=e.b,t.data[s+3]=255)}}}])&&o(e.prototype,r),s&&o(e,s),t}();e.default=s,t.exports=e.default}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9weC1icnVzaC93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vcHgtYnJ1c2gvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vcHgtYnJ1c2gvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHgtYnJ1c2gvLi9zcmMvUHhCcnVzaC5qcyIsIndlYnBhY2s6Ly9weC1icnVzaC8uL3NyYy9TdGFtcE1ha2VyLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9TdGFtcE1ha2VyIiwiUHhCcnVzaCIsImNhbnZhcyIsIl9jbGFzc0NhbGxDaGVjayIsImNvbnRleHQiLCJnZXRDb250ZXh0Iiwic3RhbXBNYWtlciIsImRlZmF1bHQiLCJjb25maWdQaXhlbFJhdGlvIiwiX3RoaXMkY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJkcHIiLCJzdHlsZSIsImNvbmNhdCIsInNjYWxlIiwiaW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwiZmlsZU5hbWUiLCJfdGhpcyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVzdWx0Q2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicmVzdWx0Q29udGV4dCIsIl90aGlzJGNhbnZhczIiLCJyZWR1Y2VkV2lkdGgiLCJyZWR1Y2VkSGVpZ2h0IiwiZHJhd0ltYWdlIiwidG9CbG9iIiwiYmxvYiIsImxhc3RNb2RpZmVkRGF0ZSIsIkRhdGUiLCJwb2ludDEiLCJwb2ludDIiLCJNYXRoIiwic3FydCIsInBvdyIsIngiLCJ5IiwiYXRhbjIiLCJmcm9tIiwiX3JlZiIsInRvIiwic2l6ZSIsImNvbG9yIiwiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIiwiYnJ1c2giLCJfcmVmMiIsIl90aGlzMiIsIl9yZWYzIiwiaGFsZlNpemUiLCJzdGFtcCIsIm1ha2UiLCJkaXN0IiwiZGlzdGFuY2VCZXR3ZWVuIiwiYW5nbGUiLCJhbmdsZUJldHdlZW4iLCJfbG9vcCIsInNpbiIsImNvcyIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJvdW5kIiwiZGV2aWNlUGl4ZWxSYXRpbyIsIkhleFBhdHRlcm4iLCJSR0JQYXR0ZXJuIiwiU3RhbXBNYWtlciIsImNhbnZhc2VzIiwiaXNIZXgiLCJ0ZXN0IiwiaXNSR0IiLCJFcnJvciIsInNsaWNlIiwibGVuZ3RoIiwic3BsaXQiLCJyZWR1Y2UiLCJhY2MiLCJpdCIsIl90b0NvbnN1bWFibGVBcnJheSIsImpvaW4iLCJwYXJzZUludCIsImciLCJiIiwiX2NvbG9yJHJlcGxhY2Ukc3BsaXQkMiIsIl9zbGljZWRUb0FycmF5IiwicmVwbGFjZSIsIm1hcCIsIl9jb2xvciIsInBhcnNlQ29sb3IiLCJfc3RyQ29sb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiaW1hZ2VEYXRhIiwiY3JlYXRlSW1hZ2VEYXRhIiwiZGF0YSIsInBsb3RDaXJjbGUiLCJmaWxsQ2lyY2xlIiwicHV0SW1hZ2VEYXRhIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwieG0iLCJ5bSIsImlpIiwiaWlpIiwiaXYiLCJjb2xzIiwicm93IiwiaXNIaXRDb2xvciIsImlzSGl0Q2xlYXIiLCJpc0VuZGVkIiwiY29sIiwiaW5kZXgiLCJhbHBoYSIsImlzQ29s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QUFVLEVBQ0xDLEVBQU0sRUFBR0EsRUFBTUwsRUFBTUssR0FBTyxFQUFHLENBQ3RDLElBQU1DLEVBQVFOLEVBQU9DLEVBQU1JLEVBQ3JCRSxFQUFRckIsRUFBVUUsS0FBS2tCLEVBQVEsR0FDL0JFLEVBQW9CLE1BQVZELEVBRVpDLElBQVlOLEVBQ2RBLEdBQWEsRUFGVyxJQUFWSyxHQUdNTCxFQUNwQkMsR0FBYSxFQUNKSyxHQUFXTixHQUFjQyxJQUNsQ0MsR0FBVSxHQUVSRixHQUFjQyxJQUFlQyxJQUMvQmxCLEVBQVVFLEtBQUtrQixHQUFTcEUsRUFBTS9ELEVBQzlCK0csRUFBVUUsS0FBS2tCLEVBQVEsR0FBS3BFLEVBQU1xQyxFQUNsQ1csRUFBVUUsS0FBS2tCLEVBQVEsR0FBS3BFLEVBQU1zQyxFQUNsQ1UsRUFBVUUsS0FBS2tCLEVBQVEsR0FBSyIsImZpbGUiOiJweC1icnVzaC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcInB4LWJydXNoXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInB4LWJydXNoXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcInB4LWJydXNoXCJdID0gZmFjdG9yeSgpO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCBQeEJydXNoIGZyb20gJy4vUHhCcnVzaCdcbmV4cG9ydCBkZWZhdWx0IFB4QnJ1c2giLCJpbXBvcnQgU3RhbXBNYWtlciBmcm9tICcuL1N0YW1wTWFrZXInXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFB4QnJ1c2gge1xuICBjb25zdHJ1Y3RvciAoY2FudmFzKSB7XG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXNcbiAgICB0aGlzLmNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICAgIHRoaXMuc3RhbXBNYWtlciA9IG5ldyBTdGFtcE1ha2VyKClcbiAgICB0aGlzLmNvbmZpZ1BpeGVsUmF0aW8oKVxuICB9XG5cbiAgZ2V0IGRwciAoKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDFcbiAgfVxuXG4gIGNvbmZpZ1BpeGVsUmF0aW8gKCkge1xuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5jYW52YXNcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpZHRoICogdGhpcy5kcHJcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKiB0aGlzLmRwclxuICAgIHRoaXMuY2FudmFzLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgXG4gICAgdGhpcy5jYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YFxuICAgIHRoaXMuY29udGV4dC5zY2FsZSh0aGlzLmRwciwgdGhpcy5kcHIpXG4gICAgdGhpcy5jb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlXG4gIH1cblxuICBleHBvcnRBc1BORyAoZmlsZU5hbWUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBjb25zdCByZXN1bHRDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuICAgICAgY29uc3QgcmVzdWx0Q29udGV4dCA9IHJlc3VsdENhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG4gICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHRoaXMuY2FudmFzXG4gICAgICBjb25zdCByZWR1Y2VkV2lkdGggPSB3aWR0aCAvIHRoaXMuZHByXG4gICAgICBjb25zdCByZWR1Y2VkSGVpZ2h0ID0gaGVpZ2h0IC8gdGhpcy5kcHJcbiAgICAgIHJlc3VsdENhbnZhcy53aWR0aCA9IHJlZHVjZWRXaWR0aFxuICAgICAgcmVzdWx0Q2FudmFzLmhlaWdodCA9IHJlZHVjZWRIZWlnaHRcbiAgICAgIHJlc3VsdENvbnRleHQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2VcbiAgICAgIHJlc3VsdENvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICB0aGlzLmNhbnZhcyxcbiAgICAgICAgMCwgMCwgd2lkdGgsIGhlaWdodCxcbiAgICAgICAgMCwgMCwgcmVkdWNlZFdpZHRoLCByZWR1Y2VkSGVpZ2h0XG4gICAgICApXG4gICAgICByZXN1bHRDYW52YXMudG9CbG9iKGJsb2IgPT4ge1xuICAgICAgICBibG9iLmxhc3RNb2RpZmVkRGF0ZSA9IG5ldyBEYXRlKClcbiAgICAgICAgYmxvYi5uYW1lID0gZmlsZU5hbWVcbiAgICAgICAgcmVzb2x2ZShibG9iKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG5cbiAgZGlzdGFuY2VCZXR3ZWVuIChwb2ludDEsIHBvaW50Mikge1xuICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3cocG9pbnQyLnggLSBwb2ludDEueCwgMikgKyBNYXRoLnBvdyhwb2ludDIueSAtIHBvaW50MS55LCAyKSlcbiAgfVxuXG4gIGFuZ2xlQmV0d2VlbiAocG9pbnQxLCBwb2ludDIpIHtcbiAgICByZXR1cm4gTWF0aC5hdGFuMihwb2ludDIueCAtIHBvaW50MS54LCBwb2ludDIueSAtIHBvaW50MS55KVxuICB9XG5cbiAgZHJhdyAoeyBmcm9tLCB0bywgc2l6ZSwgY29sb3IgfSkge1xuICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInXG4gICAgdGhpcy5icnVzaCh7IGZyb20sIHRvLCBzaXplLCBjb2xvciB9KVxuICB9XG5cbiAgZXJhc2UgKHsgZnJvbSwgdG8sIHNpemUgfSkge1xuICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnZGVzdGluYXRpb24tb3V0J1xuICAgIHRoaXMuYnJ1c2goeyBmcm9tLCB0bywgc2l6ZSwgY29sb3I6ICcjMDAwMDAwJyB9KVxuICB9XG5cbiAgYnJ1c2ggKHsgZnJvbSwgdG8sIHNpemUsIGNvbG9yIH0pIHtcbiAgICBjb25zdCBoYWxmU2l6ZSA9IChzaXplIC0gKHNpemUgJSAyKSkgLyAyXG4gICAgY29uc3Qgc3RhbXAgPSB0aGlzLnN0YW1wTWFrZXIubWFrZSh7IHNpemUsIGNvbG9yIH0pXG4gICAgaWYgKGZyb20ueCA9PT0gdG8ueCAmJiBmcm9tLnkgPT09IHRvLnkpIHtcbiAgICAgIGNvbnN0IHggPSBmcm9tLnggLSBoYWxmU2l6ZVxuICAgICAgY29uc3QgeSA9IGZyb20ueSAtIGhhbGZTaXplXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHN0YW1wLCBNYXRoLnJvdW5kKHgpLCBNYXRoLnJvdW5kKHkpLCBzaXplLCBzaXplKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNvbnN0IGRpc3QgPSB0aGlzLmRpc3RhbmNlQmV0d2Vlbihmcm9tLCB0bylcbiAgICBjb25zdCBhbmdsZSA9IHRoaXMuYW5nbGVCZXR3ZWVuKGZyb20sIHRvKVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlzdDsgaSArPSAxKSB7XG4gICAgICBjb25zdCB4ID0gZnJvbS54ICsgKE1hdGguc2luKGFuZ2xlKSAqIGkpIC0gaGFsZlNpemVcbiAgICAgIGNvbnN0IHkgPSBmcm9tLnkgKyAoTWF0aC5jb3MoYW5nbGUpICogaSkgLSBoYWxmU2l6ZVxuICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2Uoc3RhbXAsIE1hdGgucm91bmQoeCksIE1hdGgucm91bmQoeSksIHNpemUsIHNpemUpXG4gICAgICB9KVxuICAgIH1cbiAgfVxufVxuIiwiY29uc3QgSGV4UGF0dGVybiA9IC9eIz9bMC05QS1GYS1mXXsxLDJ9WzAtOUEtRmEtZl17MSwyfVswLTlBLUZhLWZdezEsMn0kL1xuY29uc3QgUkdCUGF0dGVybiA9IC9ecmdiXFwoKFxccyspP1swLTldezEsM30sKFxccyspP1swLTldezEsM30sKFxccyspP1swLTldezEsM30oXFxzKyk/XFwpJC9cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RhbXBNYWtlciB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLmNhbnZhc2VzID0ge31cbiAgfVxuXG4gIHBhcnNlQ29sb3IgKGNvbG9yKSB7XG4gICAgY29uc3QgaXNIZXggPSBIZXhQYXR0ZXJuLnRlc3QoY29sb3IpXG4gICAgY29uc3QgaXNSR0IgPSBSR0JQYXR0ZXJuLnRlc3QoY29sb3IpXG4gICAgaWYgKCFpc0hleCAmJiAhaXNSR0IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ29sb3IgaXMgbm90IGNvcnJlY3QgZm9ybWF0LiAjMTIzMTIzIG9yIHJnYigxMjMsIDEyMywgMTIzKSBmb3JtYXQgcmVxdWlyZWQuJylcbiAgICB9XG4gICAgaWYgKGlzSGV4KSB7XG4gICAgICBsZXQgYyA9IGNvbG9yWzBdID09PSAnIycgPyBjb2xvci5zbGljZSgxKSA6IGNvbG9yXG4gICAgICBjID0gYy5sZW5ndGggPT09IDNcbiAgICAgICAgPyBjLnNwbGl0KCcnKS5yZWR1Y2UoKGFjYywgaXQpID0+IFsuLi5hY2MsIGl0LCBpdF0sIFtdKS5qb2luKCcnKVxuICAgICAgICA6IGNcbiAgICAgIGNvbnN0IHIgPSBwYXJzZUludChjLnNsaWNlKDAsIDIpLCAxNilcbiAgICAgIGNvbnN0IGcgPSBwYXJzZUludChjLnNsaWNlKDIsIDQpLCAxNilcbiAgICAgIGNvbnN0IGIgPSBwYXJzZUludChjLnNsaWNlKDQsIDYpLCAxNilcbiAgICAgIHJldHVybiB7IHIsIGcsIGIgfVxuICAgIH1cbiAgICBpZiAoaXNSR0IpIHtcbiAgICAgIGxldCBbciwgZywgYl0gPSBjb2xvclxuICAgICAgICAucmVwbGFjZSgvcmdifFxccyt8XFwofFxcKS9nLCAnJylcbiAgICAgICAgLnNwbGl0KCcsJylcbiAgICAgICAgLm1hcChpdCA9PiBwYXJzZUludChpdCkpXG4gICAgICByID0gciA+IDI1NSA/IDI1NSA6IHJcbiAgICAgIGcgPSBnID4gMjU1ID8gMjU1IDogZ1xuICAgICAgYiA9IGIgPiAyNTUgPyAyNTUgOiBiXG4gICAgICByZXR1cm4geyByLCBnLCBiIH1cbiAgICB9XG4gIH1cblxuICBtYWtlICh7IHNpemUsIGNvbG9yIH0pIHtcbiAgICB0cnkge1xuICAgICAgc2l6ZSA9IHNpemUgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb1xuICAgICAgY29uc3QgX2NvbG9yID0gdGhpcy5wYXJzZUNvbG9yKGNvbG9yKVxuICAgICAgY29uc3QgX3N0ckNvbG9yID0gSlNPTi5zdHJpbmdpZnkoX2NvbG9yKVxuICAgICAgdGhpcy5jYW52YXNlc1tfc3RyQ29sb3JdID0gdGhpcy5jYW52YXNlc1tfc3RyQ29sb3JdIHx8IHt9XG5cbiAgICAgIGlmICh0aGlzLmNhbnZhc2VzW19zdHJDb2xvcl1bc2l6ZV0gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXNlc1tfc3RyQ29sb3JdW3NpemVdXG4gICAgICB9XG4gICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuICAgICAgc2l6ZSA9IHNpemUgKyAoc2l6ZSAlIDIpXG4gICAgICBjYW52YXMud2lkdGggPSBzaXplXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZVxuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJylcbiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuY3JlYXRlSW1hZ2VEYXRhKHNpemUsIHNpemUpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgIGltYWdlRGF0YS5kYXRhW2ldID0gMjU1XG4gICAgICAgIGltYWdlRGF0YS5kYXRhW2kgKyAxXSA9IDI1NVxuICAgICAgICBpbWFnZURhdGEuZGF0YVtpICsgMl0gPSAyNTVcbiAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDNdID0gMFxuICAgICAgfVxuICAgICAgdGhpcy5wbG90Q2lyY2xlKHNpemUgKiAyLCAoc2l6ZSAqIDQpICogKHNpemUgLyAyKSwgc2l6ZSAvIDIsIGltYWdlRGF0YSwgc2l6ZSwgX2NvbG9yKVxuICAgICAgdGhpcy5maWxsQ2lyY2xlKGltYWdlRGF0YSwgX2NvbG9yKVxuICAgICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKVxuICAgICAgdGhpcy5jYW52YXNlc1tfc3RyQ29sb3JdW3NpemVdID0gY2FudmFzXG4gICAgICByZXR1cm4gY2FudmFzXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycilcbiAgICB9XG4gIH1cblxuICBwbG90Q2lyY2xlICh4bSwgeW0sIHIsIGltYWdlRGF0YSwgc2l6ZSwgY29sb3IpIHtcbiAgICBsZXQgeCA9IC1yXG4gICAgbGV0IHkgPSAwXG4gICAgbGV0IGVyciA9IDIgLSAyICogciAvKiBib3R0b20gbGVmdCB0byB0b3AgcmlnaHQgKi9cblxuICAgIGRvIHtcbiAgICAgIC8qICAgSS4gUXVhZHJhbnQgK3ggK3kgKi9cbiAgICAgIGNvbnN0IGkgPSB4bSAtICgoeCArIDEpICogNCkgKyAoeW0gKyAoKHkgLSAxKSAqIChzaXplICogNCkpKVxuICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDBdID0gY29sb3IuclxuICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDFdID0gY29sb3IuZ1xuICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDJdID0gY29sb3IuYlxuICAgICAgaW1hZ2VEYXRhLmRhdGFbaSArIDNdID0gMjU1XG4gICAgICAvKiAgSUkuIFF1YWRyYW50IC14ICt5ICovXG4gICAgICBjb25zdCBpaSA9IHhtIC0gKHkgKiAoc2l6ZSAqIDQpKSArICh5bSAtICgoeCArIDEpICogNCkpXG4gICAgICBpbWFnZURhdGEuZGF0YVtpaSArIDBdID0gY29sb3IuclxuICAgICAgaW1hZ2VEYXRhLmRhdGFbaWkgKyAxXSA9IGNvbG9yLmdcbiAgICAgIGltYWdlRGF0YS5kYXRhW2lpICsgMl0gPSBjb2xvci5iXG4gICAgICBpbWFnZURhdGEuZGF0YVtpaSArIDNdID0gMjU1XG4gICAgICAvKiBJSUkuIFF1YWRyYW50IC14IC15ICovXG4gICAgICBjb25zdCBpaWkgPSAoeG0gKyAoeCAqIDQpKSArICh5bSAtICh5ICogKHNpemUgKiA0KSkpXG4gICAgICBpbWFnZURhdGEuZGF0YVtpaWkgKyAwXSA9IGNvbG9yLnJcbiAgICAgIGltYWdlRGF0YS5kYXRhW2lpaSArIDFdID0gY29sb3IuZ1xuICAgICAgaW1hZ2VEYXRhLmRhdGFbaWlpICsgMl0gPSBjb2xvci5iXG4gICAgICBpbWFnZURhdGEuZGF0YVtpaWkgKyAzXSA9IDI1NVxuICAgICAgLyogIElWLiBRdWFkcmFudCAreCAteSAqL1xuICAgICAgY29uc3QgaXYgPSAoeG0gKyAoKHkgLSAxKSAqIChzaXplICogNCkpKSArICh5bSArICh4ICogNCkpXG4gICAgICBpbWFnZURhdGEuZGF0YVtpdiArIDBdID0gY29sb3IuclxuICAgICAgaW1hZ2VEYXRhLmRhdGFbaXYgKyAxXSA9IGNvbG9yLmdcbiAgICAgIGltYWdlRGF0YS5kYXRhW2l2ICsgMl0gPSBjb2xvci5iXG4gICAgICBpbWFnZURhdGEuZGF0YVtpdiArIDNdID0gMjU1XG4gICAgICByID0gZXJyXG4gICAgICBpZiAociA8PSB5KSB7XG4gICAgICAgIGVyciArPSArK3kgKiAyICsgMSAvKiB5IHN0ZXAgKi9cbiAgICAgIH1cbiAgICAgIGlmIChyID4geCB8fCBlcnIgPiB5KSB7XG4gICAgICAgIGVyciArPSArK3ggKiAyICsgMSAvKiB4IHN0ZXAgKi9cbiAgICAgIH1cbiAgICB9IHdoaWxlICh4IDwgMClcbiAgfVxuXG4gIGZpbGxDaXJjbGUgKGltYWdlRGF0YSwgY29sb3IpIHtcbiAgICBjb25zdCBjb2xzID0gaW1hZ2VEYXRhLndpZHRoICogNFxuICAgIGZvciAobGV0IHJvdyA9IDE7IHJvdyA8IGltYWdlRGF0YS5oZWlnaHQgLSAxOyByb3cgKz0gMSkge1xuICAgICAgbGV0IGlzSGl0Q29sb3IgPSBmYWxzZVxuICAgICAgbGV0IGlzSGl0Q2xlYXIgPSBmYWxzZVxuICAgICAgbGV0IGlzRW5kZWQgPSBmYWxzZVxuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgY29sczsgY29sICs9IDQpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBjb2xzICogcm93ICsgY29sXG4gICAgICAgIGNvbnN0IGFscGhhID0gaW1hZ2VEYXRhLmRhdGFbaW5kZXggKyAzXVxuICAgICAgICBjb25zdCBpc0NvbG9yID0gYWxwaGEgPT09IDI1NVxuICAgICAgICBjb25zdCBpc0NsZWFyID0gYWxwaGEgPT09IDBcbiAgICAgICAgaWYgKGlzQ29sb3IgJiYgIWlzSGl0Q29sb3IpIHtcbiAgICAgICAgICBpc0hpdENvbG9yID0gdHJ1ZVxuICAgICAgICB9IGVsc2UgaWYgKGlzQ2xlYXIgJiYgaXNIaXRDb2xvcikge1xuICAgICAgICAgIGlzSGl0Q2xlYXIgPSB0cnVlXG4gICAgICAgIH0gZWxzZSBpZiAoaXNDb2xvciAmJiBpc0hpdENvbG9yICYmIGlzSGl0Q2xlYXIpIHtcbiAgICAgICAgICBpc0VuZGVkID0gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIGlmIChpc0hpdENvbG9yICYmIGlzSGl0Q2xlYXIgJiYgIWlzRW5kZWQpIHtcbiAgICAgICAgICBpbWFnZURhdGEuZGF0YVtpbmRleF0gPSBjb2xvci5yXG4gICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbaW5kZXggKyAxXSA9IGNvbG9yLmdcbiAgICAgICAgICBpbWFnZURhdGEuZGF0YVtpbmRleCArIDJdID0gY29sb3IuYlxuICAgICAgICAgIGltYWdlRGF0YS5kYXRhW2luZGV4ICsgM10gPSAyNTVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==